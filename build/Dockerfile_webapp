FROM node:8-alpine

ARG WEBAPP_NAME
ARG WEBAPP_PORT

# setup a user so as not to run as root
# see: https://github.com/nodejs/docker-node/blob/master/docs/BestPractices.md#non-root-user
RUN adduser -S wellcomecollection
ENV HOME=/home/wellcomecollection
USER wellcomecollection
WORKDIR $HOME/

COPY ./${WEBAPP_NAME}/app ./${WEBAPP_NAME}/app
COPY ./server/ ./server/

WORKDIR $HOME/${WEBAPP_NAME}/app/.dist
EXPOSE ${WEBAPP_PORT}
CMD ["node", "app"]
