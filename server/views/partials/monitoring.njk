<script src="https://cdn.ravenjs.com/3.26.3/raven.min.js" async onload="setupMonitoring()" crossorigin="anonymous"></script>
<script>
  function setupMonitoring() {
    var oldSafari = /^.*Version\/[0-8]\..*Safari.*$/;
    var bingPreview = /^.*BingPreview.*$/;

    var ignoredUserAgentRegex = [
      oldSafari,
      bingPreview
    ];

    // Unsure how this is consistently slipping through our
    // whitlistUrls and ignoreUrls -- possibly a browser plugin.
    var reallyIgnoredUrls = [
      /googleusercontent/
    ];

    function shouldIgnore(regexArray, stringToMatch) {
      return regexArray.some(function(regex) {
        return regex.test(stringToMatch);
      });
    }

    var shouldIgnoreBrowsers = shouldIgnore(ignoredUserAgentRegex, window.navigator.userAgent);

    Raven.config('https://f756b8d4b492473782987a054aa9a347@sentry.io/133634', {
      shouldSendCallback: function(data) {
        if (data.request && data.request.url) {
          var shouldReallyIgnoreUrls = shouldIgnore(reallyIgnoredUrls, data.request.url);

          if (shouldReallyIgnoreUrls) return false;
        }

        return !shouldIgnoreBrowsers;
      },
      whitelistUrls: [/wellcomecollection\.org/],
      ignoreUrls: [/translate\.googleusercontent\.com/],
      ignoreErrors: [
        /Blocked a frame with origin/,
        /document\.getElementsByClassName\.ToString/ // https://github.com/SamsungInternet/support/issues/56
      ]
    }).install();
  }
</script>
