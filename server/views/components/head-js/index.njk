<script>
  (function() {
    if ('visibilityState' in document) { // Cutting the Mustard
      var rootElement = document.documentElement;
      var enhancedClass = 'enhanced';
      var enhancedScriptPath = '/assets/js/{{file}}';

      function addEnhancedClass() {
        rootElement.classList.add(enhancedClass);
      }

      function removeEnhancedClass() {
        rootElement.classList.remove(enhancedClass);
      }

      function loadJS(src) {
        var ref = window.document.getElementsByTagName('script')[ 0 ];
        var script = window.document.createElement('script');
        script.src = src;
        ref.parentNode.insertBefore(script, ref);
        return script;
      }

      addEnhancedClass(); //gets the enhanced styles, as we don't want them to go from basic to enhanced in front of the user

      var script = loadJS(enhancedScriptPath);
      var fallback = setTimeout(removeEnhancedClass, 8000); // BUT if JS doesn't load, we don't want the enhanced styles anymore

      script.onload = function() {
        clearTimeout(fallback);
        addEnhancedClass(); // Can't cancel the request, so we need to add this here in case we removed it with the setTimeout and the javascript ends up loaded.
      };
    }
  })();
</script>
